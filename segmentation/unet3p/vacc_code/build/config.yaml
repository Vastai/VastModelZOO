model:
  name: unet3p
  inputs:
    input: [1, 3, 128, 128]
  checkpoint: unet3p-3_128_128.onnx

engine:
  type: vacc
  dtype: int8
  common:
    data_transport_mode: 1
  add_extra_ops_to_graph:
    type: null
  calibration:
    calibrate_mode: kl_divergence
    quantize_per_channel: true
    
dataset:
  path: /home/simplew/dataset/seg/AutoPortraitMatting/testing/images
  sampler:
    suffix: png
    get_data_num: 100
  transform_ops:
    - type: DecodeImage
    - type: CvtColor
      code: COLOR_RGB2BGR
    - type: Resize
      size: [128, 128]
    - type: Normalize
      norm_type: None
    - type: ToTensor

workspace:
  work_dir: ./deploy_weights/
  enable_ir: true
  save_log: true

# cd /home/simplew/code/vamc/vamp/2.1.0
# ./vamp_2.1.0 -m /home/simplew/code/vastmodelzoo/0818/algorithm_modelzoo/deploy_weights/unet3p-int8-kl_divergence-1_3_128_128-vacc/mod --vdsp_params /home/simplew/code/vastmodelzoo/0818/algorithm_modelzoo/segmentation/unet3p/vacc_code/vdsp_params/unetzoo-unetpp-vdsp_params.json -i 1 -b 1 -p 1
# - number of instances in each device: 1
#   devices: [0]
#   batch size: 1
#   ai utilize (%): 95.0294
#   temperature (°C): 46.3129
#   card power (W): 35.6416
#   die memory used (MB): 1196.74
#   throughput (qps): 261.411
#   e2e latency (us):
#     avg latency: 9429
#     min latency: 4292
#     max latency: 11732
#     p50 latency: 7958
#     p90 latency: 11353
#     p95 latency: 11381
#     p99 latency: 11442
#   model latency (us):
#     avg latency: 9385
#     min latency: 4256
#     max latency: 11681
#     p50 latency: 7894
#     p90 latency: 11306
#     p95 latency: 11330
#     p99 latency: 11383

# ./vamp_2.1.0 -m /home/simplew/code/vastmodelzoo/0818/algorithm_modelzoo/deploy_weights/unet3p_deepsupervision-int8-kl_divergence-1_3_128_128-vacc/mod --vdsp_params /home/simplew/code/vastmodelzoo/0818/algorithm_modelzoo/segmentation/unet3p/vacc_code/vdsp_params/unetzoo-unet3p_deepsupervision-vdsp_params.json -i 1 -b 1 -p 1
# model input shape 0: [3,128,128], dtype: u1
# load model and init graph done
# - number of instances in each device: 1
#   devices: [0]
#   batch size: 1
#   ai utilize (%): 94.9512
#   temperature (°C): 46.3605
#   card power (W): 34.3433
#   die memory used (MB): 1196.74
#   throughput (qps): 221.447
#   e2e latency (us):
#     avg latency: 11148
#     min latency: 5144
#     max latency: 13947
#     p50 latency: 9436
#     p90 latency: 13428
#     p95 latency: 13492
#     p99 latency: 13607
#   model latency (us):
#     avg latency: 11100
#     min latency: 5080
#     max latency: 13887
#     p50 latency: 9372
#     p90 latency: 13384
#     p95 latency: 13442
#     p99 latency: 13548
