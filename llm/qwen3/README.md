# Qwen3

- Technical Report
    - [Qwen3 Technical Report](https://arxiv.org/abs/2505.09388)
- Huggingface
    - https://huggingface.co/Qwen


## Model Arch

![qwen_arch](../../images/llm/qwen/qwen_arch.png)


### Qwen3
- æ¨¡å‹ç»“æ„
    - Qwen3åŸºäºQwen2æ”¹è¿›ï¼Œä¿®æ”¹è¾ƒå°ï¼Œå¯¹æŸ¥è¯¢ (Query) å’Œé”® (Key) æ·»åŠ å½’ä¸€åŒ– (RMSNorm)
- æ¨¡å‹é¢„è®­ç»ƒ
    - åœ¨é¢„è®­ç»ƒæ–¹é¢ï¼ŒQwen3 çš„æ•°æ®é›†ç›¸æ¯” Qwen2.5 æœ‰äº†æ˜¾è‘—æ‰©å±•ã€‚Qwen2.5æ˜¯åœ¨ 18 ä¸‡äº¿ä¸ª token ä¸Šè¿›è¡Œé¢„è®­ç»ƒçš„ï¼Œè€Œ Qwen3 ä½¿ç”¨çš„æ•°æ®é‡å‡ ä¹æ˜¯å…¶ä¸¤å€ï¼Œè¾¾åˆ°äº†çº¦ 36 ä¸‡äº¿ä¸ª tokenï¼Œæ¶µç›–äº† 119 ç§è¯­è¨€å’Œæ–¹è¨€ã€‚ä¸ºäº†æ„å»ºè¿™ä¸ªåºå¤§çš„æ•°æ®é›†ï¼Œæˆ‘ä»¬ä¸ä»…ä»ç½‘ç»œä¸Šæ”¶é›†æ•°æ®ï¼Œè¿˜ä» PDF æ–‡æ¡£ä¸­æå–ä¿¡æ¯ã€‚æˆ‘ä»¬ä½¿ç”¨ Qwen2.5-VL ä»è¿™äº›æ–‡æ¡£ä¸­æå–æ–‡æœ¬ï¼Œå¹¶ç”¨ Qwen2.5 æ”¹è¿›æå–å†…å®¹çš„è´¨é‡ã€‚ä¸ºäº†å¢åŠ æ•°å­¦å’Œä»£ç æ•°æ®çš„æ•°é‡ï¼Œæˆ‘ä»¬åˆ©ç”¨ Qwen2.5-Math å’Œ Qwen2.5-Coder è¿™ä¸¤ä¸ªæ•°å­¦å’Œä»£ç é¢†åŸŸçš„ä¸“å®¶æ¨¡å‹åˆæˆæ•°æ®ï¼Œåˆæˆäº†åŒ…æ‹¬æ•™ç§‘ä¹¦ã€é—®ç­”å¯¹ä»¥åŠä»£ç ç‰‡æ®µç­‰å¤šç§å½¢å¼çš„æ•°æ®ã€‚
    - é¢„è®­ç»ƒè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼ˆS1ï¼‰ï¼Œæ¨¡å‹åœ¨è¶…è¿‡ 30 ä¸‡äº¿ä¸ª token ä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒï¼Œä¸Šä¸‹æ–‡é•¿åº¦ä¸º 4K tokenã€‚è¿™ä¸€é˜¶æ®µä¸ºæ¨¡å‹æä¾›äº†åŸºæœ¬çš„è¯­è¨€æŠ€èƒ½å’Œé€šç”¨çŸ¥è¯†ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼ˆS2ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡å¢åŠ çŸ¥è¯†å¯†é›†å‹æ•°æ®ï¼ˆå¦‚ STEMã€ç¼–ç¨‹å’Œæ¨ç†ä»»åŠ¡ï¼‰çš„æ¯”ä¾‹æ¥æ”¹è¿›æ•°æ®é›†ï¼Œéšåæ¨¡å‹åˆåœ¨é¢å¤–çš„ 5 ä¸‡äº¿ä¸ª token ä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒã€‚åœ¨æœ€åé˜¶æ®µï¼Œæˆ‘ä»¬ä½¿ç”¨é«˜è´¨é‡çš„é•¿ä¸Šä¸‹æ–‡æ•°æ®å°†ä¸Šä¸‹æ–‡é•¿åº¦æ‰©å±•åˆ° 32K tokenï¼Œç¡®ä¿æ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†æ›´é•¿çš„è¾“å…¥ã€‚
    - ç”±äºæ¨¡å‹æ¶æ„çš„æ”¹è¿›ã€è®­ç»ƒæ•°æ®çš„å¢åŠ ä»¥åŠæ›´æœ‰æ•ˆçš„è®­ç»ƒæ–¹æ³•ï¼ŒQwen3 Dense åŸºç¡€æ¨¡å‹çš„æ•´ä½“æ€§èƒ½ä¸å‚æ•°æ›´å¤šçš„Qwen2.5åŸºç¡€æ¨¡å‹ç›¸å½“ã€‚ä¾‹å¦‚ï¼ŒQwen3-1.7B/4B/8B/14B/32B-Base åˆ†åˆ«ä¸ Qwen2.5-3B/7B/14B/32B/72B-Base è¡¨ç°ç›¸å½“ã€‚ç‰¹åˆ«æ˜¯åœ¨ STEMã€ç¼–ç å’Œæ¨ç†ç­‰é¢†åŸŸï¼ŒQwen3 Dense åŸºç¡€æ¨¡å‹çš„è¡¨ç°ç”šè‡³è¶…è¿‡äº†æ›´å¤§è§„æ¨¡çš„ Qwen2.5 æ¨¡å‹ã€‚å¯¹äº Qwen3 MoE åŸºç¡€æ¨¡å‹ï¼Œå®ƒä»¬åœ¨ä»…ä½¿ç”¨ 10% æ¿€æ´»å‚æ•°çš„æƒ…å†µä¸‹è¾¾åˆ°äº†ä¸ Qwen2.5 Dense åŸºç¡€æ¨¡å‹ç›¸ä¼¼çš„æ€§èƒ½ã€‚è¿™å¸¦æ¥äº†è®­ç»ƒå’Œæ¨ç†æˆæœ¬çš„æ˜¾è‘—èŠ‚çœã€‚
- æ¨¡å‹åè®­ç»ƒ
    - ä¸ºäº†å¼€å‘èƒ½å¤ŸåŒæ—¶å…·å¤‡æ€è€ƒæ¨ç†å’Œå¿«é€Ÿå“åº”èƒ½åŠ›çš„æ··åˆæ¨¡å‹ï¼Œæˆ‘ä»¬å®æ–½äº†ä¸€ä¸ªå››é˜¶æ®µçš„è®­ç»ƒæµç¨‹ã€‚è¯¥æµç¨‹åŒ…æ‹¬ï¼šï¼ˆ1ï¼‰é•¿æ€ç»´é“¾å†·å¯åŠ¨ï¼Œï¼ˆ2ï¼‰é•¿æ€ç»´é“¾å¼ºåŒ–å­¦ä¹ ï¼Œï¼ˆ3ï¼‰æ€ç»´æ¨¡å¼èåˆï¼Œä»¥åŠï¼ˆ4ï¼‰é€šç”¨å¼ºåŒ–å­¦ä¹ ã€‚
    - åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šæ ·çš„çš„é•¿æ€ç»´é“¾æ•°æ®å¯¹æ¨¡å‹è¿›è¡Œäº†å¾®è°ƒï¼Œæ¶µç›–äº†æ•°å­¦ã€ä»£ç ã€é€»è¾‘æ¨ç†å’Œ STEM é—®é¢˜ç­‰å¤šç§ä»»åŠ¡å’Œé¢†åŸŸã€‚è¿™ä¸€è¿‡ç¨‹æ—¨åœ¨ä¸ºæ¨¡å‹é…å¤‡åŸºæœ¬çš„æ¨ç†èƒ½åŠ›ã€‚
    - ç¬¬äºŒé˜¶æ®µçš„é‡ç‚¹æ˜¯å¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ ï¼Œåˆ©ç”¨åŸºäºè§„åˆ™çš„å¥–åŠ±æ¥å¢å¼ºæ¨¡å‹çš„æ¢ç´¢å’Œé’»ç ”èƒ½åŠ›ã€‚
    - åœ¨ç¬¬ä¸‰é˜¶æ®µï¼Œæˆ‘ä»¬åœ¨ä¸€ä»½åŒ…æ‹¬é•¿æ€ç»´é“¾æ•°æ®å’Œå¸¸ç”¨çš„æŒ‡ä»¤å¾®è°ƒæ•°æ®çš„ç»„åˆæ•°æ®ä¸Šå¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œå°†éæ€è€ƒæ¨¡å¼æ•´åˆåˆ°æ€è€ƒæ¨¡å‹ä¸­ã€‚ç¡®ä¿äº†æ¨ç†å’Œå¿«é€Ÿå“åº”èƒ½åŠ›çš„æ— ç¼ç»“åˆã€‚æœ€åï¼Œåœ¨ç¬¬å››é˜¶æ®µï¼Œæˆ‘ä»¬åœ¨åŒ…æ‹¬æŒ‡ä»¤éµå¾ªã€æ ¼å¼éµå¾ªå’Œ Agent èƒ½åŠ›ç­‰åœ¨å†…çš„ 20 å¤šä¸ªé€šç”¨é¢†åŸŸçš„ä»»åŠ¡ä¸Šåº”ç”¨äº†å¼ºåŒ–å­¦ä¹ ï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºæ¨¡å‹çš„é€šç”¨èƒ½åŠ›å¹¶çº æ­£ä¸è‰¯è¡Œä¸ºã€‚

- å¤šç§æ€è€ƒæ¨¡å¼
    - æ€è€ƒæ¨¡å¼ï¼šåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¨¡å‹ä¼šé€æ­¥æ¨ç†ï¼Œç»è¿‡æ·±æ€ç†Ÿè™‘åç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•éå¸¸é€‚åˆéœ€è¦æ·±å…¥æ€è€ƒçš„å¤æ‚é—®é¢˜ã€‚
    - éæ€è€ƒæ¨¡å¼ï¼šåœ¨æ­¤æ¨¡å¼ä¸­ï¼Œæ¨¡å‹æä¾›å¿«é€Ÿã€è¿‘ä¹å³æ—¶çš„å“åº”ï¼Œé€‚ç”¨äºé‚£äº›å¯¹é€Ÿåº¦è¦æ±‚é«˜äºæ·±åº¦çš„ç®€å•é—®é¢˜ã€‚
    - è¿™ç§çµæ´»æ€§ä½¿ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®å…·ä½“ä»»åŠ¡æ§åˆ¶æ¨¡å‹è¿›è¡Œâ€œæ€è€ƒâ€çš„ç¨‹åº¦ã€‚ä¾‹å¦‚ï¼Œå¤æ‚çš„é—®é¢˜å¯ä»¥é€šè¿‡æ‰©å±•æ¨ç†æ­¥éª¤æ¥è§£å†³ï¼Œè€Œç®€å•çš„é—®é¢˜åˆ™å¯ä»¥ç›´æ¥å¿«é€Ÿä½œç­”ï¼Œæ— éœ€å»¶è¿Ÿã€‚è‡³å…³é‡è¦çš„æ˜¯ï¼Œè¿™ä¸¤ç§æ¨¡å¼çš„ç»“åˆå¤§å¤§å¢å¼ºäº†æ¨¡å‹å®ç°ç¨³å®šä¸”é«˜æ•ˆçš„â€œæ€è€ƒé¢„ç®—â€æ§åˆ¶èƒ½åŠ›ã€‚å¦‚ä¸Šæ–‡æ‰€è¿°ï¼ŒQwen3 å±•ç°å‡ºå¯æ‰©å±•ä¸”å¹³æ»‘çš„æ€§èƒ½æå‡ï¼Œè¿™ä¸åˆ†é…çš„è®¡ç®—æ¨ç†é¢„ç®—ç›´æ¥ç›¸å…³ã€‚è¿™æ ·çš„è®¾è®¡è®©ç”¨æˆ·èƒ½å¤Ÿæ›´è½»æ¾åœ°ä¸ºä¸åŒä»»åŠ¡é…ç½®ç‰¹å®šçš„é¢„ç®—ï¼Œåœ¨æˆæœ¬æ•ˆç›Šå’Œæ¨ç†è´¨é‡ä¹‹é—´å®ç°æ›´ä¼˜çš„å¹³è¡¡ã€‚
- å…¶å®ƒç‰¹æ€§
    - Agentï¼šä¼˜åŒ–äº†Qwen3æ¨¡å‹çš„ Agent å’Œ ä»£ç èƒ½åŠ›ï¼ŒåŒæ—¶ä¹ŸåŠ å¼ºäº†å¯¹ MCP çš„æ”¯æŒã€‚ä¸‹é¢æˆ‘ä»¬å°†æä¾›ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤º Qwen3 æ˜¯å¦‚ä½•æ€è€ƒå¹¶ä¸ç¯å¢ƒè¿›è¡Œäº¤äº’çš„ã€‚
    - å¤šè¯­è¨€ï¼šQwen3 æ¨¡å‹æ”¯æŒ 119 ç§è¯­è¨€å’Œæ–¹è¨€ã€‚è¿™ä¸€å¹¿æ³›çš„å¤šè¯­è¨€èƒ½åŠ›ä¸ºå›½é™…åº”ç”¨å¼€è¾Ÿäº†æ–°çš„å¯èƒ½æ€§ï¼Œè®©å…¨çƒç”¨æˆ·éƒ½èƒ½å—ç›Šäºè¿™äº›æ¨¡å‹çš„å¼ºå¤§åŠŸèƒ½ã€‚

## Build_In Deploy

### step.1 æ¨¡å‹å‡†å¤‡

1. ä¸‹è½½æ¨¡å‹æƒé‡

    | models | tips |
    | :---   | :--: |
    | [Qwen/Qwen3-0.6B](https://hf-mirror.com/collections/Qwen/qwen3-67dd247413f0e2e4f653967f)  | GQA |
    | [Qwen/Qwen3-1.7B](https://hf-mirror.com/collections/Qwen/qwen3-67dd247413f0e2e4f653967f)  | GQA |
    | [Qwen/Qwen3-4B](https://hf-mirror.com/collections/Qwen/qwen3-67dd247413f0e2e4f653967f)  | GQA |
    | [Qwen/Qwen3-8B](https://hf-mirror.com/collections/Qwen/qwen3-67dd247413f0e2e4f653967f)  | GQA |
    | [Qwen/Qwen3-4B-Instruct-2507](https://hf-mirror.com/collections/Qwen/qwen3-67dd247413f0e2e4f653967f)  | GQA |
    | [Qwen/Qwen3-4B-Thinking-2507](https://hf-mirror.com/collections/Qwen/qwen3-67dd247413f0e2e4f653967f)  | GQAï¼ŒThinking |


2. æ¨¡å‹ä¿®æ”¹
    - ä¸ºåœ¨ç€šåšè½¯ä»¶æ ˆéƒ¨ç½²`Qwen3`ç³»åˆ—æ¨¡å‹ï¼Œåœ¨å®˜æ–¹æºç çš„åŸºç¡€ä¸Šï¼Œéœ€è¦å¯¹`modeling_qwen2.py`åšä¸€äº›ä¿®æ”¹ï¼Œå…¶ä¸­å·¦å›¾ä¸ºä¿®æ”¹çš„ä»£ç 
    - [modeling_qwen2_vacc.py](./build_in/source_code/modeling_qwen2_vacc.py)
        - ä¿®æ”¹ç›¸å…³ä¾èµ–çš„å¯¼å…¥æ–¹å¼
        ![](../../images/llm/qwen/Snipaste_2024-04-11_14-10-36.png)
        - åŸºäºconfig.insert_sliceæ¥åˆ¤æ–­æ˜¯å¦æ’å…¥strided_slice
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-26-31.png)
        - class Qwen2ForCausalLMæ·»åŠ quantizeæ–¹æ³•ï¼Œæ”¯æŒper_channel int8é‡åŒ–ï¼Œ[quantization_vacc.py](./build_in/source_code/quantization_vacc.py)
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-29-26.png)
        - è¿ç§»transformers==4.37.0ç‰ˆæœ¬å†…cache_utils,modeling_attn_mask_utils,modeling_outputså’Œutilsä¸­ç§»åŠ¨è‡³modeling_qwen2_vacc.py

    - [configuration_qwen2_vacc.py](./build_in/source_code/configuration_qwen2_vacc.py)
        - ä¿®æ”¹å¯¹äºç›¸å…³ä¾èµ–çš„å¯¼å…¥æ–¹å¼
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-31-20.png)
    - [quantization_vacc.py](./build_in/source_code/quantization_vacc.py)
        - Qwen2ForCausalLMæ·»åŠ quantizeæ–¹æ³•ï¼Œæ”¯æŒper_channel int8é‡åŒ–
        ![](../../images/llm/qwen/Snipaste_2025-03-20_20-10-41.png)
    - [config_vacc.json](./build_in/source_code/config_vacc.json)
        - æ·»åŠ _attn_implementationé€‰é¡¹ï¼Œå¹¶å°†å…¶åªé…ç½®ä¸ºeagerï¼›å¹¶æ·»åŠ auto_mapé€‰é¡¹
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-34-02.png)
    - å°†ä»¥ä¸Šä¿®æ”¹åæ–‡ä»¶ï¼Œæ”¾ç½®ä¸åŸå§‹æƒé‡ç›®å½•ä¸‹ï¼ˆæ³¨æ„ä¸åŒå­æ¨¡å‹ï¼Œå¯¹åº”ä¿®æ”¹config_vacc.jsonæ–‡ä»¶ï¼‰

### step.2 æ•°æ®é›†

1. é‡åŒ–æ ¡å‡†æ•°æ®é›†ï¼š
    - [allenai/c4](https://hf-mirror.com/datasets/allenai/c4/tree/main/en)
        - c4-train.00000-of-01024.json.gz
        - c4-validation.00000-of-00008.json.gz
    - [ceval/ceval-exam](https://hf-mirror.com/datasets/ceval/ceval-exam/tree/main)
        - ceval-exam.zip
    - [yahma/alpaca-cleaned](https://hf-mirror.com/datasets/yahma/alpaca-cleaned/tree/main)
        - alpaca_data_cleaned.json

### step.3 æ¨¡å‹è½¬æ¢
1. æ ¹æ®å…·ä½“æ¨¡å‹ä¿®æ”¹æ¨¡å‹è½¬æ¢é…ç½®æ–‡ä»¶
    - [hf_qwen3_fp16.yaml](./build_in/build/hf_qwen3_fp16.yaml)
    - [hf_qwen3_int8.yaml](./build_in/build/hf_qwen3_int8.yaml)

    > - runstreamæ¨ç†ï¼Œç¼–è¯‘å‚æ•°`backend.type: tvm_vacc`
    > - fp16ç²¾åº¦: ç¼–è¯‘å‚æ•°`backend.dtype: fp16`
    > - int8ç²¾åº¦: ç¼–è¯‘å‚æ•°`backend.dtype: int8`

    ```bash
    vamc compile ./build_in/build/hf_qwen3_fp16.yaml
    vamc compile ./build_in/build/hf_qwen3_int8.yaml
    ```

### step.4 æ¨¡å‹æ¨ç†
1. å‚è€ƒå¤§æ¨¡å‹éƒ¨ç½²æ¨ç†å·¥å…·ï¼š[vastgenx: v1.1.0+](../../docs/vastgenx/README.md)

### Tips
- **LLMæ¨¡å‹è¯·å…ˆæŸ¥çœ‹æ¦‚è¦æŒ‡å¼•**ï¼Œ[TipsğŸ””](../README.md)
- å»ºè®®ç¯å¢ƒé…ç½®
    ```bash
    protobuf==3.20.3
    torch==2.1.0
    onnx==1.14.0
    onnxsim==0.4.28
    onnxruntime==1.13.1
    accelerate==0.25.0
    transformers==4.45
    ```

## Pytorch Deploy

### step.1 æ¨¡å‹å‡†å¤‡
|  models |    demo_code    | tips |
| :------ | :------: | :------: | 
|[Qwen/Qwen3-8B](https://hf-mirror.com/Qwen/Qwen3-8B) | [demo](./pytorch/demo/qwen3.py) | - |


### step.2 æ¨¡å‹æ¨ç†
- åŸºäº`torch_vacc`åœ¨`VA16`ç¡¬ä»¶ä¸‹æ¨ç†ï¼Œä¸€èˆ¬åŸºäºå®˜æ–¹demoè¿›è¡Œé€‚å½“ä¿®æ”¹ï¼Œå‚è§ä¸Šè¡¨`demo_code`éƒ¨åˆ†

## vLLM Deploy
### step.1 æ¨¡å‹å‡†å¤‡
|  models |    arch_tips    | deploy_tips |
| :------ | :------: | :------: | 
[Qwen/Qwen3-30B-A3B-FP8](https://hf-mirror.com/Qwen/Qwen3-30B-A3B-FP8/)   | MOEï¼ŒGQA |  VA1L/VA10L/VA16ï¼ŒTP2/4 |
[Qwen/Qwen3-30B-A3B-Instruct-2507-FP8](https://hf-mirror.com/Qwen/Qwen3-30B-A3B-Instruct-2507-FP8/)   | MOEï¼ŒGQAï¼ŒNo thinking |  VA1L/VA10L/VA16ï¼ŒTP2/4 |
[ Qwen/Qwen3-30B-A3B-Thinking-2507-FP8 ]( https://hf-mirror.com/Qwen/Qwen3-30B-A3B-Thinking-2507-FP8/ )    | MOEï¼ŒGQAï¼Œthinking | VA1L/VA10L/VA16ï¼ŒTP2/4 |


### step.2 æ¨¡å‹æ¨ç†
- å‚è€ƒï¼š[vllm/README.md](./vllm/README.md)