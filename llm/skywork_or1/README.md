# Skywork-OR1

- [Skywork Open Reasoner Series](https://capricious-hydrogen-41c.notion.site/Skywork-Open-Reasoner-Series-1d0bc9ae823a80459b46c149e4f51680)
- [Qwen2.5 Technical Report](https://arxiv.org/abs/2412.15115)
- https://huggingface.co/collections/Skywork/skywork-or1-67fa1bcb41b436ef2def76b9
- https://github.com/SkyworkAI/Skywork-OR1

## Model Arch

> è®­ç»ƒä¼˜åŒ–è·¯å¾„ï¼šQwen2.5 ---> DeepSeek-R1-Distill-Qwen ---> **Skywork-OR1**

![arch.png](../../images/llm/qwen/qwen_arch.png)


OR1é€šè¿‡ä¼˜åŒ–è®­ç»ƒæ•°æ®ç²¾ç‚¼å’Œå¤šé˜¶æ®µGRPOè®­ç»ƒç­–ç•¥ï¼Œæ›´åŠ èšç„¦äºé€»è¾‘ç†è§£ä¸å¤æ‚æ¨ç†èƒ½åŠ›çš„æå‡ã€‚


| æ¨¡å—ç±»åˆ«           | æ–¹æ³• / ç­–ç•¥åç§°             | å…·ä½“å†…å®¹è¯´æ˜                                                 |
| :----------------- | :-------------------------- | :----------------------------------------------------------- |
| **æ•°æ®æ„å»ºä¸ç­›é€‰** | **é€šè¿‡ç‡ç­›é€‰æœºåˆ¶**          | ä½¿ç”¨æœªå¾®è°ƒæ¨¡å‹è¿›è¡Œå¤šè½®é‡‡æ ·ï¼Œä»…ä¿ç•™ **é€šè¿‡ç‡ > 0 ä¸” < 1** çš„é—®é¢˜ï¼ˆæ¨¡å‹â€œæœ‰å¸Œæœ›å­¦ä¼šâ€ï¼‰ |
|                    | **æ•°æ®æ··åˆç­–ç•¥**            | è®­ç»ƒ 32B æ¨¡å‹æ—¶å¼•å…¥æ›´éš¾é—®é¢˜ï¼ˆå¦‚ NuminaMath é«˜éš¾å­é›†ï¼‰ï¼Œæ•´ä½“ä¼˜äº DeepScaleR è®­ç»ƒæ•°æ® |
|                    | **é¢˜ç›®å¯éªŒè¯æ€§è¿‡æ»¤**        | å»é™¤æ— å‚è€ƒç­”æ¡ˆã€æ— æµ‹è¯•ç”¨ä¾‹çš„é—®é¢˜ï¼›ç¡®ä¿å¥–åŠ±å‡½æ•°è¯„ä¼°ç¨³å®š       |
| **å¼ºåŒ–å­¦ä¹ ç®—æ³•**   | **å¤šé˜¶æ®µ GRPO è®­ç»ƒ**        | å¤šé˜¶æ®µæŒ‰ä¸Šä¸‹æ–‡çª—å£åˆ’åˆ†ï¼š**8K â†’ 16K â†’ 32K**ï¼Œé€æ­¥æ¨è¿›æ¨ç†é•¿åº¦ |
|                    | **æˆªæ–­å“åº”ç­–ç•¥**            | å®éªŒè¿‡ Advantage Maskï¼Œä½†æœ€ç»ˆ **å†³å®šä¸ä½¿ç”¨ä»»ä½• Advantage Mask**ï¼Œä»¥ä¿æŒ token æ•ˆç‡å’Œå¯æ‰©å±•æ€§ |
|                    | **KL æ­£åˆ™é¡¹è®¾ç½®**           | æ˜ç¡®è®¾ç½® KL ç³»æ•° ï¼Œå®Œå…¨å»é™¤ KL Lossï¼Œé¿å…é™åˆ¶ç­–ç•¥æ¼”åŒ–        |
|                    | **é‡‡æ ·æ¸©åº¦ç­–ç•¥**            | å¼ºåŒ–å­¦ä¹ ä¸­ä½¿ç”¨è¾ƒé«˜æ¸©åº¦ï¼ˆ**T = 1.0**ï¼‰ï¼Œæå‡ç»„å†…æ ·æœ¬å¤šæ ·æ€§ä¸æ¢¯åº¦ä¿¡å· |
|                    | **è‡ªé€‚åº”ç†µæ§åˆ¶æœºåˆ¶ï¼ˆAECï¼‰** | è®¾ç½®ç›®æ ‡ç†µtgt-ent=0.2ï¼Œæ¯æ­¥æ›´æ–°ç³»æ•°$c_{k+1}=c_{k}\pm0.005$                               |
| **å¥–åŠ±å‡½æ•°æœºåˆ¶**   | **æ•°å­¦ä»»åŠ¡éªŒè¯å™¨**          | é‡‡ç”¨ Math-Verifyï¼Œæ”¾å¼ƒ PRIME å’Œ Qwen2.5 verifier             |
|                    | **ä»£ç ä»»åŠ¡æ²™ç®±**            | è‡ªå»º code sandboxï¼Œç¡®ä¿ä»£ç èƒ½æ­£ç¡®è¿è¡Œå¹¶ **å…¨éƒ¨é€šè¿‡æµ‹è¯•ç”¨ä¾‹** æ‰åˆ¤å®šä¸º reward = 1 |

### æ•°æ®ç²¾åˆ¶
1. è§„åˆ™æ•°æ®ç­›é€‰ï¼Œ

ä¸ºäº†æ„å»ºé«˜è´¨é‡çš„å¼ºåŒ–å­¦ä¹ è®­ç»ƒæ•°æ®ï¼ŒSkyworkå›¢é˜Ÿé’ˆå¯¹æ•°å­¦ä¸ä»£ç ä¸¤ä¸ªä»»åŠ¡åŸŸï¼Œåˆ¶å®šäº†ç»Ÿä¸€çš„é€‰æ‹©æ ‡å‡†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
- å¯éªŒè¯æ€§ï¼ˆVerifiableï¼‰ï¼Œæ’é™¤äº†æ‰€æœ‰æ— æ³•éªŒè¯æ­£ç¡®æ€§çš„é¢˜ç›®ï¼Œä¾‹å¦‚ï¼š
    - çº¯è¯æ˜é¢˜ï¼ˆæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼‰
    - ç¼ºä¹æµ‹è¯•ç”¨ä¾‹çš„ç¼–ç¨‹é¢˜
- ç­”æ¡ˆæ­£ç¡®æ€§ï¼ˆCorrectï¼‰ï¼Œè¿‡æ»¤æ‰ï¼š
    - æ•°å­¦é¢˜ä¸­å­˜åœ¨é”™è¯¯æˆ–ä¸åˆæ³•ç­”æ¡ˆçš„é—®é¢˜
    - ç¼–ç¨‹é¢˜ä¸­æ²¡æœ‰å®Œå¤‡æµ‹è¯•ç”¨ä¾‹çš„æ ·æœ¬
- æŒ‘æˆ˜æ€§ï¼ˆChallengingï¼‰ï¼Œæå‰ç”¨åŸºç¡€æ¨¡å‹ï¼ˆå¦‚æœªå¼ºåŒ–å­¦ä¹ å‰çš„æ¨¡å‹ï¼‰å¯¹æ¯ä¸ªé—®é¢˜ç”Ÿæˆå¤šè½®ç­”æ¡ˆï¼ˆN æ¬¡ï¼‰ï¼Œç„¶åæ’é™¤ï¼š
    - å…¨éƒ¨ç­”æ¡ˆéƒ½å¯¹ï¼ˆN/N correctï¼‰çš„é—®é¢˜
    - å…¨éƒ¨ç­”æ¡ˆéƒ½é”™ï¼ˆ0/N correctï¼‰çš„é—®é¢˜

åŸºäºä»¥ä¸Šä¸‰æ¡æ ‡å‡†ï¼ŒSkywork ç²¾é€‰å‡ºäº†ä¸€æ‰¹å…·æœ‰ä»£è¡¨æ€§å’Œéš¾åº¦çš„è®­ç»ƒé¢˜ç›®ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
- æ•°å­¦æ•°æ®æ¥æº
    - NuminaMath-1.5å­é›†ï¼š
        - amc_aimeã€olympiadsã€olympiads_ref
        - aops_forumã€cn_contestã€inequalitiesã€number_theory
    - DeepScaleR
    - STILL-3 Preview RL æ•°æ®é›†
    - Omni-MATH
    - AIME2024
- ç¼–ç¨‹æ•°æ®æ¥æº
    - LeetCode
    - TACO

2. åŸºäºæ¨¡å‹æ„ŸçŸ¥çš„éš¾åº¦è¯„ä¼°

è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿ç”¨äºå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è®­ç»ƒçš„é¢˜ç›®æ—¢å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œåˆèƒ½äº§ç”Ÿæœ‰æ„ä¹‰çš„è®­ç»ƒä¿¡å·ã€‚å…³é”®æ€æƒ³æ˜¯ï¼šå…ˆç”¨æ¨¡å‹è‡ªå·±è¯•åšä¸€éé¢˜ï¼Œå†æ ¹æ®ç»“æœæ¥è¯„ä¼°é¢˜ç›®çš„éš¾åº¦ã€‚
- æ•°å­¦é¢˜ï¼šæ¯é“é¢˜è¿›è¡Œ16æ¬¡ç”Ÿæˆï¼ˆN=16ï¼‰
- ç¼–ç¨‹é¢˜ï¼šæ¯é“é¢˜è¿›è¡Œ8æ¬¡ç”Ÿæˆï¼ˆN=8ï¼‰
- ç”Ÿæˆå‚æ•°
    - temperature=1.0
    - æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦=32K tokens
- éš¾åº¦åˆ¤æ–­æ–¹å¼
    - å¯¹äºæ¯ä¸ªé¢˜ç›®ï¼Œè®°å½•æ¨¡å‹ç­”å¯¹çš„æ¯”ä¾‹ï¼ˆæ¯”å¦‚ 16 æ¬¡ä¸­ç­”å¯¹ 5 æ¬¡ï¼Œå³ 5/16ï¼‰ã€‚
    - æŒ‰ç…§è¿™ä¸ªæ¯”ä¾‹ï¼Œå°†é¢˜ç›®åˆ†ä¸ºï¼š0/Nï¼ˆå…¨é”™ï¼‰ï¼ŒN/Nï¼ˆå…¨å¯¹ï¼‰ï¼Œä¸­é—´åŒºåŸŸï¼ˆéƒ¨åˆ†ç­”å¯¹ï¼‰
- åªä¿ç•™ç¬¬ä¸‰ç±»â€”â€”æ¨¡å‹ç­”å¯¹/ç­”é”™æƒ…å†µæœ‰å·®å¼‚çš„é¢˜ç›®
    - è¿™ç±»é¢˜æœ€èƒ½æä¾›æœ‰ç”¨çš„è®­ç»ƒä¿¡å·
    - å…¨é”™/å…¨å¯¹é¢˜ç›®ä¸åˆ©äºä¼˜åŠ¿ä¼°è®¡ï¼ˆAdvantage Estimationï¼‰

3. äººç±»+å¤§æ¨¡å‹åŒé‡è¯„å®¡çš„æ•°æ®è´¨é‡è¯„ä¼°

å³ä½¿é€šè¿‡äº†å‰ä¸¤æ­¥ï¼ˆç­›é€‰+éš¾åº¦è¯„ä¼°ï¼‰ï¼Œä»æœ‰ä¸å°‘é¢˜ç›®å­˜åœ¨è´¨é‡é—®é¢˜ï¼Œæ¯”å¦‚é¢˜å¹²ä¸å®Œæ•´ã€æ ¼å¼æ··ä¹±ã€æ— å…³ä¿¡æ¯ç­‰ã€‚

Skywork å›¢é˜Ÿå‘ç°ï¼š
- è®¸å¤šæ•°å­¦é¢˜ç›® æ ¼å¼æ··ä¹±ã€ä¸å®Œæ•´ï¼Œç”šè‡³æ— å®é™…æ„ä¹‰
- æœ‰äº›é—®é¢˜åœ¨æ¨¡å‹è¯„ä¼°ä¸­è¢«æ ‡ä¸ºâ€œç­”å¯¹â€ï¼Œå…¶å®æ˜¯æ¨¡å‹å‡­ç»éªŒçŒœå¯¹çš„
- é«˜è´¨é‡è®­ç»ƒå¿…é¡»ç¡®ä¿æ•°æ®çš„æ¸…æ™°æ€§ã€å‡†ç¡®æ€§å’Œå®Œæ•´æ€§


å› æ­¤ï¼ŒSkywork å›¢é˜Ÿå¼•å…¥äº†äººç±»è¯„å®¡+å¤§æ¨¡å‹è¾…åŠ©è¯„å®¡çš„æœºåˆ¶ï¼Œè¿›ä¸€æ­¥å‰”é™¤ä½è´¨é‡é¢˜ç›®ã€‚

- äººç±»è¯„ä¼°æ ‡å‡†ï¼ˆæ‰‹åŠ¨æŠ½æ ·æ£€æŸ¥ï¼‰ï¼Œä»ä¿ç•™æ•°æ®ä¸­æŠ½å–æ ·æœ¬ï¼Œç”±äººå·¥åŸºäºä»¥ä¸‹æ ‡å‡†åšæ£€æŸ¥ï¼š

    | æ£€æŸ¥ç»´åº¦         | è¯´æ˜                                 |
    | :--------------- | :----------------------------------- |
    | **è¯­è¨€æ¸…æ™°**   | é¢˜å¹²è¡¨è¾¾æ˜¯å¦é€šé¡ºã€æ˜“æ‡‚               |
    | **ä¿¡æ¯å®Œæ•´**   | æ˜¯å¦åŒ…å«äº†æ‰€æœ‰å¿…éœ€çš„æ¡ä»¶å’ŒèƒŒæ™¯       |
    | **æ’ç‰ˆè§„èŒƒ**   | æ•°å­¦ç¬¦å·æ˜¯å¦æ­£ç¡®ã€æ ¼å¼æ˜¯å¦æ··ä¹±       |
    | **æ— å¹²æ‰°å†…å®¹** | æ˜¯å¦åŒ…å«æ— æ„ä¹‰çš„æ³¨é‡Šã€ä¹±ç ã€ç¿»è¯‘æ®‹ç•™ |

- LLM è¯„å®¡æœºåˆ¶

ä¸ºäº†æ›´é«˜æ•ˆç­›æŸ¥å¤§é‡é¢˜ç›®ï¼ŒSkywork å›¢é˜Ÿä½¿ç”¨ä¸¤ä¸ªå¼ºåŠ›å¤§æ¨¡å‹ï¼šLlama-3.3-70B-Instructï¼ŒQwen2.5-72B-Instruct

- æå‡ºç»Ÿä¸€çš„è¯„å®¡ promptï¼Œè¯·æ¨¡å‹åˆ¤æ–­é¢˜ç›®çš„è´¨é‡ï¼ˆæ˜¯å¦æ¸…æ™°ã€å®Œæ•´ã€è§„èŒƒç­‰ï¼‰
- æ¯ä¸ªé—®é¢˜ç”±ä¸¤ä¸ªæ¨¡å‹åˆ†åˆ«ç”Ÿæˆ 16 ä¸ªå›ç­”ï¼Œæ€»å…± 32 ä¸ªâ€œæŠ•ç¥¨â€
- ç»Ÿè®¡åˆ¤æ–­ç»“æœï¼šä¿ç•™è·å¾— 9 ç¥¨åŠä»¥ä¸Šè‚¯å®šè¯„ä»·çš„é¢˜ç›®
- æ¸…ç†æ‰å‰©ä¸‹çš„ä½è´¨é‡é—®é¢˜ï¼Œå¤§çº¦å»æ‰ 1000â€“2000 é“æ•°å­¦é¢˜


### è®­ç»ƒç­–ç•¥
1. å¤šé˜¶æ®µGRPOä¸è‡ªé€‚åº”ç†µæ§åˆ¶

Skywork å›¢é˜Ÿåœ¨å¸¸è§„çš„ RLHFï¼ˆå¼ºåŒ–å­¦ä¹ å¾®è°ƒï¼‰åŸºç¡€ä¸Šåšäº†ä¸‰é¡¹ä¸»è¦å¢å¼ºï¼š

- GRPOï¼ˆGrouped Rollout with Policy Optimizationï¼‰
- Multi-stage Trainingï¼ˆå¤šé˜¶æ®µè®­ç»ƒï¼‰
    | Model               | Stage 1 | Stage 2 | Stage 3 |
    | ------------------- | ------- | ------- | ------- |
    | Skywork-OR1-Math-7B | 8K      | 16K     | 32K     |
    | Skywork-OR1-7B-Preview      | 16K     | 32K     | TBD     |
    | Skywork-OR1-32B-Preview     | 16k     | 32k     | TBD     |

    - åˆæœŸä½¿ç”¨è¾ƒçŸ­ä¸Šä¸‹æ–‡ï¼ŒåŠ å¿«è®­ç»ƒé€Ÿåº¦ã€å‡å°‘èµ„æºæ¶ˆè€—
    - åæœŸå†æ‰©å±•ä¸Šä¸‹æ–‡ï¼Œæå‡å¤æ‚é—®é¢˜çš„å»ºæ¨¡èƒ½åŠ›
    - æœ‰æ•ˆç¼“è§£äº† RL è®­ç»ƒä¸­â€œé•¿åºåˆ—å­¦ä¹ æ…¢â€çš„é—®é¢˜


- Adaptive Entropy Controlï¼ˆè‡ªé€‚åº”ç†µæ§åˆ¶ï¼‰
    - ä¸ºé¿å…æ¨¡å‹åœ¨è®­ç»ƒä¸­å˜å¾—è¿‡äºä¿å®ˆï¼ˆç†µåç¼©ï¼‰ï¼ŒSkywork å¼•å…¥äº†ä¸€ä¸ªè‡ªé€‚åº”ç†µæœºåˆ¶ï¼š
        - åŠ¨æ€è°ƒæ•´ç†µæŸå¤±ç³»æ•°ï¼ˆÎ±â‚–ï¼‰ï¼Œä¿æŒè¾“å‡ºå¤šæ ·æ€§
        - å¦‚æœæ¨¡å‹ç”Ÿæˆçš„å›ç­”ç†µå¤ªä½ï¼Œä¼šè‡ªåŠ¨å¢å¼ºæ¢ç´¢ï¼ˆæé«˜ Î±â‚–ï¼‰
        - è‹¥ç†µå¤ªé«˜åˆ™å‡å°‘æƒ©ç½šï¼Œä¿æŒç¨³å®š
    - ç›®æ ‡æ˜¯ä¿è¯æ¨¡å‹å§‹ç»ˆä¿æŒâ€œæ•¢çŒœä½†ä¸ä¹±çŒœâ€çš„çŠ¶æ€â€”â€”æ¢ç´¢æ€§ä¸ç¡®å®šæ€§ä¹‹é—´çš„å¹³è¡¡ã€‚

2. é‡‡æ ·æ¸©åº¦å¯¹æ¨¡å‹ç†µçš„å½±å“

ç”±äºSkyworkä½¿ç”¨çš„GRPOæ˜¯group-wiseç­–ç•¥ä¼˜åŒ–æœºåˆ¶ï¼Œæ¨¡å‹çš„æ¯ä¸€æ­¥è®­ç»ƒéƒ½ä¼šé‡‡æ ·ä¸€ç»„ï¼ˆgroupï¼‰å“åº”ç”¨äºä¼˜åŒ–ã€‚å¦‚æœç»„å†…å“åº”é«˜åº¦ç›¸ä¼¼æˆ–è´¨é‡è¾ƒå·®ï¼Œåˆ™ä¼šæå¤§é™ä½è®­ç»ƒæ•ˆç‡ã€‚è€Œé‡‡æ ·æ¸©åº¦ï¼ˆtemperature Ï„ï¼‰çš„è®¾ç½®ä¼šç›´æ¥å½±å“ï¼š
- ç”Ÿæˆæ ·æœ¬çš„å¤šæ ·æ€§ï¼ˆdiversityï¼‰
- groupçš„æ­£ç¡®/é”™è¯¯æ¯”ä¾‹
- è¿›è€Œå½±å“RLçš„ä¼˜åŒ–ä¿¡å·ä¸æ¢¯åº¦æ–¹å‘

è®¾è®¡å®éªŒï¼Œè¯æ˜ä½¿ç”¨æ›´é«˜æ¸©åº¦æ•ˆæœæ›´ä½³ï¼š
- æœ‰åŠ©äºä¿æŒç­–ç•¥ç†µåœ¨åˆç†åŒºé—´
- é¿å…æ¨¡å‹é™·å…¥â€œå›ç­”ä¸€æ¨¡ä¸€æ ·â€çš„å±€éƒ¨æœ€ä¼˜

### å®Œå…¨å¼€æº
- è®­ç»ƒæ•°æ®
- è®­ç»ƒä»£ç 
- è®­ç»ƒæƒé‡


| Model                        | AIME24 (Avg@32) | AIME25 (Avg@32) | LiveCodeBench (8/1/24-2/1/25) (Avg@4) |
| ---------------------------- | --------------- | --------------- | ------------------------------------- |
| DeepSeek-R1-Distill-Qwen-7B  | 55.5            | 39.2            | 37.6                                  |
| Light-R1-7B-DS               | 59.1            | 44.3            | 39.5                                  |
| DeepSeek-R1-Distill-Qwen-32B | 72.9            | 59.0            | 57.2                                  |
| TinyR1-32B-Preview           | 78.1            | 65.3            | 61.6                                  |
| QwQ-32B                      | 79.5            | 65.3            | 61.6                                  |
| DeepSeek-R1                  | 79.8            | 70.0            | 65.9                                  |
| **Skywork-OR1-Math-7B**      | 69.8            | 52.3            | 43.6                                  |
| **Skywork-OR1-7B-Preview**   | 63.6            | 45.8            | 43.9                                  |
| **Skywork-OR1-32B-Preview**  | 79.7            | 69.0            | 63.9                                  |



## Model Info
### Support Models

| models  | tips |
| :---: | :--: |
| [Skywork-OR1-7B-Preview](https://huggingface.co/collections/Skywork/skywork-or1-67fa1bcb41b436ef2def76b9) |GQAï¼ŒReasoningï¼Œé€šç”¨æ¨ç†æ¨¡å‹ï¼Œè½»é‡é«˜æ•ˆ|
| [Skywork-OR1-Math-7B](https://huggingface.co/collections/Skywork/skywork-or1-67fa1bcb41b436ef2def76b9) |GQAï¼ŒReasoningï¼Œæ•°å­¦ä¸“ç”¨æ¨¡å‹ï¼Œç²¾é€šAIMEé¢˜ç›® |
| [Skywork-OR1-32B-Preview](https://huggingface.co/collections/Skywork/skywork-or1-67fa1bcb41b436ef2def76b9) |GQAï¼ŒReasoningï¼Œé«˜æ€§èƒ½æ¨ç†æ¨¡å‹ï¼Œè¿½æ±‚æè‡´æ•ˆæœ |

> - åœ¨DeepSeek-R1-Distill-Qwen-7Bå’ŒDeepSeek-R1-Distill-Qwen-32BåŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒ
> - å¦å¤–ï¼ŒDeepSeek-R1-Distill-Qwenæ˜¯åŸºäºQwen2.5å¾®è°ƒçš„


## Build_In Deploy

### step.1 æ¨¡å‹å‡†å¤‡

1. å‚è€ƒ`Support Models`åˆ—è¡¨ä¸‹è½½æ¨¡å‹æƒé‡
2. ç½‘ç»œä¿®æ”¹
    - ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²`Skywork-OR1`ç³»åˆ—æ¨¡å‹ï¼Œåœ¨å®˜æ–¹æºç çš„åŸºç¡€ä¸Šï¼Œå¯¹`modeling_qwen2.py`åšäº†ä¸€äº›ä¿®æ”¹ï¼Œå…¶ä¸­å·¦å›¾ä¸ºä¿®æ”¹çš„ä»£ç 
    - [modeling_qwen2_vacc.py](./source_code/modeling_qwen2_vacc.py)
        - ä¿®æ”¹ç›¸å…³ä¾èµ–çš„å¯¼å…¥æ–¹å¼
        ![](../../images/llm/qwen/Snipaste_2024-04-11_14-10-36.png)
        - å€ŸåŠ©config.iter_numå’Œ config.insert_sliceæ¥åˆ¤æ–­æ˜¯å¦æ’å…¥strided_slice
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-26-31.png)
        - class Qwen2ForCausalLMæ·»åŠ quantizeæ–¹æ³•ï¼Œæ”¯æŒper_channel int8é‡åŒ–ï¼Œ[quantization_vacc.py](./source_code/quantization_vacc.py)
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-29-26.png)
        - å¦‚éœ€ä½¿ç”¨transformers==4.31.0ç‰ˆæœ¬ï¼Œéƒ¨åˆ†utilså‡½æ•°æœªå®ç°ï¼›å¯ä»transformers==4.37.0ç‰ˆæœ¬å†…cache_utils,modeling_attn_mask_utils,modeling_outputså’Œutilsä¸­ç§»åŠ¨è‡³modeling_qwen2_vacc.py(å½“å‰å·²å¤åˆ¶è¿™äº›å‡½æ•°)

    - [configuration_qwen2_vacc.py](./source_code/configuration_qwen2_vacc.py)
        - ä¿®æ”¹å¯¹äºç›¸å…³ä¾èµ–çš„å¯¼å…¥æ–¹å¼
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-31-20.png)
    - [quantization_vacc.py](./source_code/quantization_vacc.py)
        - Qwen2ForCausalLMæ·»åŠ quantizeæ–¹æ³•ï¼Œæ”¯æŒper_channel int8é‡åŒ–
        ![](../../images/llm/gemma/Snipaste_2024-04-18_19-52-58.png)
    - [config.json](./source_code/config.json)
        - æ·»åŠ _attn_implementationé€‰é¡¹ï¼Œå¹¶å°†å…¶åªé…ç½®ä¸ºeagerï¼›å¹¶æ·»åŠ auto_mapé€‰é¡¹
        ![](../../images/llm/qwen/Snipaste_2024-04-15_17-34-02.png)
        
    - å°†ä»¥ä¸Šæ–‡ä»¶ç§»åŠ¨è‡³åŸå§‹æƒé‡è·¯å¾„å†…ï¼Œè¦†ç›–åŒåæ–‡ä»¶

> ä¿®æ”¹åŒQwen2.5

### step.2 æ•°æ®é›†

1. é‡åŒ–æ ¡å‡†æ•°æ®é›†ï¼š
    - [allenai/c4](https://hf-mirror.com/datasets/allenai/c4/tree/main/en)
        - c4-train.00000-of-01024.json.gz
        - c4-validation.00000-of-00008.json.gz
    - [ceval/ceval-exam](https://hf-mirror.com/datasets/ceval/ceval-exam/tree/main)
        - ceval-exam.zip
    - [yahma/alpaca-cleaned](https://hf-mirror.com/datasets/yahma/alpaca-cleaned/tree/main)
        - alpaca_data_cleaned.json

### step.3 æ¨¡å‹è½¬æ¢
1. æ ¹æ®å…·ä½“æ¨¡å‹ä¿®æ”¹æ¨¡å‹è½¬æ¢é…ç½®æ–‡ä»¶
    - v1/v2/v2.5æ¨¡å‹ï¼Œç¼–è¯‘é…ç½®ä¸€è‡´
    - [hf_skywork_or1_fp16.yaml](./build_in/build/hf_skywork_or1_fp16.yaml)
    - [hf_skywork_or1_in8.yaml](./build_in/build/hf_skywork_or1_in8.yaml)

    > - runstreamæ¨ç†ï¼Œç¼–è¯‘å‚æ•°`backend.type: tvm_vacc`
    > - fp16ç²¾åº¦: ç¼–è¯‘å‚æ•°`backend.dtype: fp16`
    > - int8ç²¾åº¦: ç¼–è¯‘å‚æ•°`backend.dtype: int8`

    ```bash
    cd skywork_or1
    mkdir workspace
    cd workspace
    vamc compile ./build_in/build/hf_skywork_or1_fp16.yaml
    vamc compile ./build_in/build/hf_skywork_or1_in8.yaml
    ```

### step.4 æ¨¡å‹æ¨ç†
1. å‚è€ƒå¤§æ¨¡å‹éƒ¨ç½²æ¨ç†å·¥å…·ï¼š[vastgenx](../../docs/vastgenx/README.md)

### Tips
- **LLMæ¨¡å‹è¯·å…ˆæŸ¥çœ‹æ¦‚è¦æŒ‡å¼•**ï¼Œ[TipsğŸ””](../README.md)
- ä¾èµ–é…ç½®
    ```bash
    protobuf==3.20.3
    torch==2.1.0
    onnx==1.14.0
    onnxsim==0.4.35
    onnxruntime==1.13.1
    transformers==4.45.2
    ```
- æ³¨æ„åœ¨åŠ è½½tokenizeræ—¶ï¼Œéœ€è¦æŒ‰å¦‚ä¸‹æ–¹å¼åŠ è½½ï¼š`tokenizer=AutoTokenizer.from_pretrained(model_weights_path)`
